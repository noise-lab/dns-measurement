\section{Background and Related Work}\label{sec:background}

The Domain Name System (DNS) translates human-readable domain names into
Internet Protocol (IP) addresses, which are used to route
traffic~\cite{dns-rfcs}.  These queries are traditionally unencrypted, which
enables on-path eavesdroppers to intercept queries and manipulate responses.
\subsection{Background: Encrypted DNS}

\paragraph{Encrypted DNS.}
Protocols for encrypting DNS traffic have been proposed, standardized, and
deployed in recent years, including DNS-over-HTTPS (DoH) and DNS-over-TLS
(DoT).  Hu et al. proposed DoT in 2016 to address the eavesdropping and
tampering of DNS queries~\cite{hu2016DoT}.  It uses a dedicated port (853)
to communicate with resolvers over a TLS connection.  In contrast,
DoH---proposed by Hoffman et al. in 2018---establishes HTTPS sessions with
resolvers over port 443~\cite{hoffman2018DoH}.  This design decision enables
DoH traffic to use HTTPS as a transport, facilitating deployment as well as
making it difficult for network operators and eavesdroppers to intercept DNS
queries and responses~\cite{boettger2019empirical}. DoH can function in many
environments where DoT is easily blocked.

\paragraph{Centralization.}
Encrypting DNS queries and responses hides queries from eavesdroppers but the
recipient of the queries---the DNS resolver---can see the
queries~\cite{IEEEfight}. By design, recursive resolvers receive queries from
clients and may perform additional queries to other name servers to resolve
domain names.  For these resolvers to determine what additional
queries they need to perform (or determine if the query can be answered from a
cache), they must decrypt the queries that they receive from clients.  Thus,
although DoT and DoH make it difficult for network operators and eavesdroppers
to intercept DNS traffic, recursive resolvers can still
observe (and potentially, log) the queries that they receive from clients.
The fact that many mainstream DoH providers (e.g., Google) already collect
significant information about users potentially raises additional privacy
concerns and makes it appealing for users to have a large number of encrypted
DNS resolvers that are reliable and perform well.

Most major browsers currently support DoH, including Brave, Chrome, Edge,
Firefox, Opera, Safari, and Vivaldi.  Operating systems have also announced
plans to implement DoH, including iOS, MacOS, and
Windows~\cite{ffSettings,operaEdgeSettings,vivaldiSettings,iosSettings,jensen2020windows}.
For this study, we chose to focus on DoH because it is more widely implemented
than DoT.  Each of these browsers and operating systems either
currently support or have announced support for DoH (but not
DoT)~\cite{lack-of-dot-support}.

\subsection{Related Work}

Previous studies measuring DoT and DoH response times largely
focus on and compare the protocols as a whole, rather than the performance of
individual resolvers~\cite{lu2019end-to-end}.  
In this paper, we measure query response times and reachability for a large
list of DoH resolvers, many of which are not available as default options in
major browsers. 
Our research specifically
focuses on collecting measurements of the larger DoH ecosystem to better
understand what options are practically available to DoH clients.

Researchers have measured the performance of encrypted DNS protocols and compared them to traditional DNs in various ways.
Zhu et al. proposed DoT to encrypt DNS traffic between clients and recursive resolvers~\cite{zhu2015connection}.
They modeled its performance and found that DoT's overhead can be largely eliminated with connection re-use.
BÃ¶ttger et al. measured the effect of DoT and DoH on query response times and page load times from a university network~\cite{boettger2019empirical}.
They find that DNS generally outperforms DoT in response times, and DoT outperforms DoH.
They also find that much of the performance cost for DoT and DoH can be amortized by re-using TCP connections and TLS sessions.
Hounsel et al. also measure response times and page load times for DNS, DoT, and DoH using Amazon EC2 instances~\cite{hounsel2020comparing}.
They compare the recursive resolvers for Cloudflare, Google, and Quad9 to the local recursive resolvers provided by Amazon EC2 from five global vantage points in Ohio, California, Seoul, Sydney, and Frankfurt.
They find that despite higher response times, page load times for DoT and DoH can be \emph{faster} than DNS on lossy networks.
Lu et al. utilized residential TCP SOCKS networks to measure response times from 166 countries and found that, in the median case with connection re-use, DoT and DoH were slower than conventional DNS over TCP by 9 ms and 6 ms, respectively~\cite{lu2019end}.

Researchers have also studied in depth how DNS performance influences application performance.
Sundaresan et al. used an early MBA deployment of 4,200 home gateways to identify performance bottlenecks for residential broadband networks~\cite{sundaresan2013measuring}.
This study found that page load times for users in home networks are significantly influenced by slow DNS response times.
Wang et al. introduced WProf, a profiling system that analyzes various factors that contribute to page load times~\cite{wang2013demystifying}.
They found that queries for uncached domain names at recursive resolvers can account for up to 13\% of the critical path delay for page loads.
Otto et al. found that CDN performance was significantly affected by clients choosing recursive resolvers that are far away from CDN caches~\cite{otto2012content}.
As a result of these findings. Otto et al. proposed \textit{namehelp}, a DNS proxy that sends queries for CDN-hosted content to directly to authoritative servers.
Allman studied conventional DNS performance from 100 residences in a neighborhood and found that only 3.6\% of connections were blocked on DNS with lookup times greater than either 20 ms or 1\% of the application's total transaction time~\cite{allman2020putting}.

Lastly, rsearchers have studied the centralization of the DNS and proposed various techniques to address it.
Foremski et al. find that the top 10\% of DNS recursors serve approximately 50\% of DNS traffic~\cite{foremski2019dns-observatory}.
Moura et al.~\cite{moura2020clouding} also encounter centralization in their study of DNS requests to two country code top-level domains (ccTLD), with five large cloud providers being responsible for over 30\% of all queries for the ccTLDs of the Netherlands and New Zealand.
Hoang et al.~\cite{hoang2020kresolver} propose and evaluate K-resolver, which distributes queries over multiple DoH recursors, so that no single resolver can build a complete profile of the user and each recursor only learns a subset of domains the user resolved.
Hounsel et al. also evaluate the performance of various query distribution strategies and study how these strategies affect the amount of queries seen by individual resolvers~\cite{hounsel2021multi}.
